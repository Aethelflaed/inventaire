{
   "_id": "_design/user",
   "language": "coffeescript",
   "views": {
       "byEmail": {
           "map": "(doc)->\n  if doc.type is 'user'\n    emit doc.email.toLowerCase(), null"
       },
       "byUsername": {
           "map": "(doc)->\n  if doc.type is 'user'\n    emit doc.username.toLowerCase(), null"
       },
       "byCreation": {
           "map": "(doc)->\n  if doc.type is 'user'\n    emit doc.created, doc.username"
       },
       "byId": {
           "map": "(doc)->\n  if doc.type is 'user'\n    emit doc._id, null"
       },
       "byPosition": {
           "map": "(doc)->\n  if doc.position?\n    emit doc.position, null"
       },
       "nextSummary": {
           "map": "(doc)->\n  unless doc.type is 'user' then return\n  if doc.settings.notifications.global is false then return\n  if doc.settings.notifications['inventories_activity_summary'] is false then return\n\n  lastSummary = doc.lastSummary or doc.created\n  summaryPeriodicity = doc.summaryPeriodicity or 20\n  nextSummary = lastSummary + summaryPeriodicity*24*3600*1000\n  emit nextSummary, null"
       }
   }
}